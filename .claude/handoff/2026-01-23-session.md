# Handoff: 2026-01-23 (обновлено)

## Текущее состояние проекта

### Серверы
```bash
# Запущены и работают:
Next.js:  http://localhost:3000
Convex:   http://localhost:3210

# Запуск (если нужно перезапустить):
pnpm dev          # Next.js
pnpm convex:dev   # Convex (отдельный терминал)
```

### Конфигурация (.env.local)
```env
# Convex (local development - своя БД)
CONVEX_DEPLOYMENT=anonymous:anonymous-sharity-vinhloc
NEXT_PUBLIC_CONVEX_URL=http://127.0.0.1:3210

# Clerk Auth (Sharity team - Винлока)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_bGFyZ2UtcG9sZWNhdC0yMy5jbGVyay5hY2NvdW50cy5kZXYk
CLERK_SECRET_KEY=sk_test_1dycE4hsM32bsSM0DXFPIkmCnihaEP4U56WQ4IWMEn
CLERK_ISSUER_URL=https://large-polecat-23.clerk.accounts.dev
```

### Сохранённые облачные креды (.env.cloud)
Для командного тестирования с prod данными — скопировать в .env.local когда нужно.

---

## Что было сделано в этой сессии

### 1. Исправлена конфигурация Clerk + Convex ✅
- Разобрались с миксом ключей от разных Clerk инстансов
- Настроили: локальный Convex + Clerk Винлока (large-polecat-23)
- `convex/auth.config.ts` теперь читает из env (не захардкожено)

### 2. Исправлен z-index карты ✅
- Leaflet карта перекрывала модальные окна
- Понизили z-index Leaflet, повысили для Radix Dialog
- Коммит: `67c2c57 fix: modal z-index over Leaflet map and use env for Clerk URL`

### 3. Понимание workflow
```
Для разработки:     локальный Convex + Clerk Винлока
Для команды (prod): облачный Convex + Clerk Винлока (.env.cloud)
```

---

## Git состояние

### Ветка
`feat/categories-map-locations` — отстаёт от `main` на 16 коммитов

### Незакоммиченные файлы (твоя работа)
```
app/profile/
app/user/
components/avatar-upload.tsx
components/contact-info.tsx
components/pending-ratings.tsx
components/profile-edit-modal.tsx
components/profile-form.tsx
components/profile-provider.tsx
components/profile-setup-modal.tsx
components/rating-form.tsx
components/rating-summary.tsx
components/ratings-list.tsx
components/star-rating.tsx
components/user-history.tsx
convex/ratings.ts
convex/users.ts
```

---

## Следующий шаг: Тестирование с Email + Password

### Проблема
- В Clerk только OAuth (Google, Facebook, Apple)
- Playwright не может автоматизировать Google OAuth
- Нужен Email + Password для E2E тестов

### Что нужно от Винлока
Включить в Clerk Dashboard (Configure → User & authentication):
- Sign-up with email ✅
- Sign-in with email ✅
- Password → Enable ✅

### Сообщение отправлено Винлоку
Ждём ответа на включение Email + Password.

### После включения Email + Password
1. Создать тестовых пользователей:
   - `test-owner@test.com` / `TestPassword123!`
   - `test-borrower@test.com` / `TestPassword123!`

2. Можно тестировать рейтинговую систему:
   - Owner создаёт item
   - Borrower делает claim
   - Owner approve
   - После return — появляется форма рейтинга

---

## Clerk Dashboard

### Доступ
Workspace: **Sharity** (не Personal workspace!)
URL: https://dashboard.clerk.com → переключиться на Sharity

### Существующие пользователи
| Имя | Email |
|-----|-------|
| Loc Nguyen | loc@architect.co |
| Dmitriy Surkov | dksurkov@gmail.com |
| Jenya Bogacheva | genie.alexie@gmail.com |
| Nguyễn Hoàng Vĩnh Lộc | loc.nguyen@shelf.beauty |
| Loc Nguyen | vinhloc30796@gmail.com |

---

## Файлы рейтинговой системы (для тестирования)

### Backend
- `convex/ratings.ts` — queries & mutations

### Frontend
- `components/rating-form.tsx` — форма оценки
- `components/star-rating.tsx` — компонент звёзд
- `components/rating-summary.tsx` — сводка рейтинга
- `components/ratings-list.tsx` — список отзывов
- `components/pending-ratings.tsx` — ожидающие оценки

### Что проверить в UI
1. После завершения аренды — появляется ли форма для оценки?
2. Star rating — работает ли выбор звёзд (1-5)?
3. Отправка отзыва — сохраняется ли в базу?
4. Отображение рейтинга на профиле пользователя
5. Pending ratings — видны ли ожидающие оценки

---

## Полезные команды

```bash
# Проверить серверы
lsof -i :3000   # Next.js
lsof -i :3210   # Convex

# Git
git status
git log --oneline -5
git fetch origin && git log --oneline HEAD..origin/main  # что нового в main

# Переключиться на prod (когда нужно)
cp .env.cloud .env.local
# и перезапустить Next.js (Convex не нужен для облака)
```

---

## Ссылки

- Clerk Dashboard: https://dashboard.clerk.com (workspace: Sharity)
- Clerk Testing Docs: https://clerk.com/docs/guides/development/testing/overview
- GitHub Repo: https://github.com/vinhloc30796/sharity

---

*Последнее обновление: 2026-01-23 22:00*
